---
phase: 35-mobile-redesign
plan: 04
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - src/components/mobile/mobile-status-drawer.tsx
  - src/components/mobile/mobile-emoji-picker.tsx
  - src/components/layout/mobile-tab-bar.tsx
  - src/components/emoji/emoji-picker-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "User can set/clear status from mobile"
    - "Status editor opens as bottom sheet on mobile"
    - "Emoji picker opens as bottom sheet on mobile"
    - "Emoji grid shows 6 columns on mobile"
    - "Quick reactions available on long-press"
  artifacts:
    - path: "src/components/mobile/mobile-status-drawer.tsx"
      provides: "Status editor in drawer for mobile"
      min_lines: 40
    - path: "src/components/mobile/mobile-emoji-picker.tsx"
      provides: "Emoji picker in drawer for mobile"
      min_lines: 50
  key_links:
    - from: "src/components/mobile/mobile-emoji-picker.tsx"
      to: "src/components/emoji/emoji-picker.tsx"
      via: "import EmojiPicker"
      pattern: "EmojiPicker"
---

<objective>
Add mobile-friendly status editor and emoji picker using bottom sheet presentation.

Purpose: Status and emoji picker currently use Popover which works on desktop but is awkward on mobile. Bottom sheets provide a native mobile experience with proper touch targets and visibility.

Output: Status accessible from mobile, emoji picker with touch-optimized layout and quick reactions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/35-mobile-redesign/35-CONTEXT.md
@.planning/phases/35-mobile-redesign/35-RESEARCH.md
@src/components/status/status-editor.tsx
@src/components/emoji/emoji-picker.tsx
@src/components/ui/drawer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileStatusDrawer component</name>
  <files>
    src/components/mobile/mobile-status-drawer.tsx
  </files>
  <action>
Create a mobile-friendly status editor that presents the StatusEditor in a drawer:

```typescript
// src/components/mobile/mobile-status-drawer.tsx
"use client";

import { Smile } from "lucide-react";
import {
  Drawer,
  DrawerContent,
  DrawerHeader,
  DrawerTitle,
  DrawerTrigger,
} from "@/components/ui/drawer";
import { StatusEditor, UserStatusData } from "@/components/status/status-editor";
import { StatusDisplay } from "@/components/status/status-display";

interface MobileStatusDrawerProps {
  currentStatus?: UserStatusData | null;
  onStatusSaved?: (status: UserStatusData) => void;
  onStatusCleared?: () => void;
}

export function MobileStatusDrawer({
  currentStatus,
  onStatusSaved,
  onStatusCleared,
}: MobileStatusDrawerProps) {
  const [open, setOpen] = useState(false);

  const handleSaved = (status: UserStatusData) => {
    onStatusSaved?.(status);
    setOpen(false);
  };

  const handleCleared = () => {
    onStatusCleared?.();
    setOpen(false);
  };

  return (
    <Drawer open={open} onOpenChange={setOpen}>
      <DrawerTrigger asChild>
        <button className="flex items-center gap-2 min-h-11 px-3 py-2 w-full text-left rounded-md hover:bg-accent transition-colors">
          {currentStatus?.emoji ? (
            <StatusDisplay emoji={currentStatus.emoji} text={currentStatus.text} />
          ) : (
            <Smile className="h-5 w-5 text-muted-foreground" />
          )}
          <span className={currentStatus?.emoji || currentStatus?.text ? "" : "text-muted-foreground"}>
            {currentStatus?.text || "Set status"}
          </span>
        </button>
      </DrawerTrigger>
      <DrawerContent>
        <DrawerHeader>
          <DrawerTitle>Set your status</DrawerTitle>
        </DrawerHeader>
        <div className="px-4 pb-4">
          <StatusEditor
            currentStatus={currentStatus}
            onClose={() => setOpen(false)}
            onStatusSaved={handleSaved}
            onStatusCleared={handleCleared}
          />
        </div>
      </DrawerContent>
    </Drawer>
  );
}
```

Key requirements:
- Reuse existing StatusEditor component
- Present in Drawer for mobile-native feel
- 44px touch target on trigger
- Pass through callbacks for status updates
  </action>
  <verify>
1. File exists: src/components/mobile/mobile-status-drawer.tsx
2. TypeScript compiles without errors
3. StatusEditor renders inside drawer
  </verify>
  <done>
MobileStatusDrawer created with StatusEditor in bottom sheet presentation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MobileEmojiPicker component</name>
  <files>
    src/components/mobile/mobile-emoji-picker.tsx
  </files>
  <action>
Create a mobile-optimized emoji picker using drawer:

```typescript
// src/components/mobile/mobile-emoji-picker.tsx
"use client";

import { Drawer, DrawerContent } from "@/components/ui/drawer";
import { EmojiPicker } from "@/components/emoji/emoji-picker";

interface CustomEmojiData {
  id: string;
  name: string;
  path: string;
  isAnimated: boolean;
}

interface MobileEmojiPickerProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSelect: (emoji: string) => void;
  customEmojis?: CustomEmojiData[];
}

export function MobileEmojiPicker({
  open,
  onOpenChange,
  onSelect,
  customEmojis = [],
}: MobileEmojiPickerProps) {
  const handleSelect = (emoji: string) => {
    onSelect(emoji);
    onOpenChange(false);
  };

  return (
    <Drawer open={open} onOpenChange={onOpenChange}>
      <DrawerContent className="max-h-[85vh]">
        <div className="px-2 pb-4 pt-2">
          <EmojiPicker
            onSelect={handleSelect}
            customEmojis={customEmojis}
          />
        </div>
      </DrawerContent>
    </Drawer>
  );
}
```

IMPORTANT: The EmojiPicker component from emoji-mart needs mobile optimization:
- Check if emoji-mart supports `perLine` prop (it does)
- Set perLine={6} for mobile (larger targets, 6 columns per CONTEXT)
- Verify this can be passed through

If EmojiPicker wrapper doesn't support perLine, update src/components/emoji/emoji-picker.tsx to accept and forward it:
```typescript
interface EmojiPickerProps {
  onSelect: (emoji: string) => void;
  customEmojis?: CustomEmojiData[];
  autoFocus?: boolean;
  perLine?: number; // Add this
}
// Then pass to Picker: perLine={perLine ?? 9}
```
  </action>
  <verify>
1. File exists: src/components/mobile/mobile-emoji-picker.tsx
2. TypeScript compiles
3. EmojiPicker renders in drawer
4. Verify perLine prop is supported
  </verify>
  <done>
MobileEmojiPicker created with bottom sheet presentation and mobile-optimized layout.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add status access to mobile navigation</name>
  <files>
    src/components/mobile/mobile-more-menu.tsx
  </files>
  <action>
Add status setting to the More menu so users can set status on mobile (MOBI2-04).

Update MobileMoreMenu to include a status trigger. This requires:

1. The More menu needs access to current status and update handlers
2. Add props to MobileMoreMenu:
```typescript
interface MobileMoreMenuProps {
  workspaceSlug: string;
  currentStatus?: UserStatusData | null;
  onStatusSaved?: (status: UserStatusData) => void;
  onStatusCleared?: () => void;
}
```

3. Add MobileStatusDrawer to the menu, placed at the top before navigation links:
```tsx
<div className="px-4 pb-2 border-b mb-2">
  <MobileStatusDrawer
    currentStatus={currentStatus}
    onStatusSaved={onStatusSaved}
    onStatusCleared={onStatusCleared}
  />
</div>
```

4. Update MobileTabBar to pass status props through to MobileMoreMenu. This requires:
   - MobileTabBar receiving status props from layout
   - Passing them to MobileMoreMenu

5. Update workspace layout to pass status to MobileTabBar:
```tsx
<MobileTabBar
  workspaceSlug={workspaceSlug}
  currentStatus={myStatus}
  // Status updates would need server action or state management
/>
```

For simplicity, since status uses server actions:
- Display current status in More menu
- User taps to open status editor (in nested drawer or navigate to profile)
- On save, the page would refresh to show new status

Alternative simpler approach: Add "Set Status" as a link item that opens the profile page where status can be set. This avoids complex state passing.

Choose the approach based on complexity:
- If status state can be passed down easily: Use MobileStatusDrawer inline
- If complex: Add "Set Status" link to profile page
  </action>
  <verify>
1. User can access status setting from mobile
2. Status can be set/cleared
3. Changes reflect in UI
  </verify>
  <done>
Status is accessible from mobile navigation (MOBI2-04 satisfied).
  </done>
</task>

</tasks>

<verification>
1. MobileStatusDrawer opens as bottom sheet with status editor
2. MobileEmojiPicker opens as bottom sheet with emoji grid
3. Status accessible from mobile More menu
4. Emoji picker has 6 columns on mobile
5. All touch targets are 44px minimum
</verification>

<success_criteria>
- MOBI2-04: User status can be set/cleared from mobile
- MOBI2-05: Custom emoji picker works on mobile with touch-optimized layout
- Bottom sheet presentation feels native on mobile
- Existing functionality preserved on desktop
</success_criteria>

<output>
After completion, create `.planning/phases/35-mobile-redesign/35-04-SUMMARY.md`
</output>
