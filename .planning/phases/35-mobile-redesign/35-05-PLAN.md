---
phase: 35-mobile-redesign
plan: 05
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - src/components/channel/channel-header.tsx
autonomous: true

must_haves:
  truths:
    - "Channel header shows overflow menu on mobile"
    - "Overflow menu contains all channel actions"
    - "Menu items include: Notifications, Notes, Pins, Members, Settings, Leave"
    - "Each menu item has 44px minimum touch target"
  artifacts:
    - path: "src/components/channel/channel-header.tsx"
      provides: "Channel header with complete mobile overflow menu"
      contains: "min-h-11"
  key_links:
    - from: "src/components/channel/channel-header.tsx"
      to: "DropdownMenu"
      via: "mobile overflow menu"
      pattern: "md:hidden"
---

<objective>
Enhance channel header mobile overflow menu to include all actions (pins, notes, members, notifications, settings).

Purpose: The channel header already has a mobile overflow menu but it's missing several actions that are available on desktop. Users need access to pinned messages, channel notes, and notification settings on mobile.

Output: Complete mobile overflow menu with all channel actions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/35-mobile-redesign/35-CONTEXT.md
@src/components/channel/channel-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing actions to mobile overflow menu</name>
  <files>
    src/components/channel/channel-header.tsx
  </files>
  <action>
The current mobile overflow menu only has: Members, Settings (admin), Leave.

Add these missing actions to the mobile DropdownMenu:
1. **Notification settings** - Bell icon, opens NotificationSettingsDialog
2. **Channel notes** - FileText icon, opens ChannelNotesSheet
3. **Pinned messages** - Pin icon, opens PinnedMessagesDialog

Update the mobile overflow menu section (inside `md:hidden`):

```tsx
<DropdownMenuContent align="end" className="w-56">
  {/* Notification settings */}
  <DropdownMenuItem
    onSelect={(e) => {
      e.preventDefault();
      // Open notification dialog - need to track state
    }}
    className="min-h-11"
  >
    <Bell className="h-4 w-4 mr-2" />
    Notifications
  </DropdownMenuItem>

  {/* Channel notes */}
  <DropdownMenuItem
    onSelect={(e) => {
      e.preventDefault();
      // Open notes sheet - need to track state
    }}
    className="min-h-11"
  >
    <FileText className="h-4 w-4 mr-2" />
    Channel notes
  </DropdownMenuItem>

  {/* Pinned messages */}
  <DropdownMenuItem
    onSelect={(e) => {
      e.preventDefault();
      // Open pinned dialog - need to track state
    }}
    className="min-h-11"
  >
    <Pin className="h-4 w-4 mr-2" />
    Pinned messages
  </DropdownMenuItem>

  <DropdownMenuSeparator />

  {/* Members - already exists */}
  <DropdownMenuItem onSelect={() => setShowMembersDialog(true)} className="min-h-11">
    <Users className="h-4 w-4 mr-2" />
    Members ({channel.memberCount})
  </DropdownMenuItem>

  {/* Settings - admin only, already exists */}
  {isAdmin && (
    <DropdownMenuItem asChild className="min-h-11">
      <Link href={`/${workspaceSlug}/channels/${channel.slug}/settings`}>
        <Settings className="h-4 w-4 mr-2" />
        Settings
      </Link>
    </DropdownMenuItem>
  )}

  <DropdownMenuSeparator />

  {/* Leave - already exists */}
  <DropdownMenuItem
    onSelect={() => setShowLeaveDialog(true)}
    className="text-destructive focus:text-destructive min-h-11"
  >
    <LogOut className="h-4 w-4 mr-2" />
    Leave channel
  </DropdownMenuItem>
</DropdownMenuContent>
```

For the dialogs/sheets that need to open from dropdown:
- Add state variables: `showNotificationDialog`, `showNotesSheet`, `showPinnedDialog`
- The existing components (NotificationSettingsDialog, ChannelNotesSheet, PinnedMessagesDialog) need to be controlled from state

Option A (preferred): These components may already support `open` and `onOpenChange` props. Check their interfaces. If so, add state and render them outside the dropdown.

Option B: If they only support trigger-based opening, they can be rendered inside DialogTrigger/SheetTrigger wrappers, but this is awkward in dropdowns.

For PinnedMessagesDialog and NotificationSettingsDialog, they likely use Dialog internally with DialogTrigger. To open them programmatically, you may need to refactor them to accept open/onOpenChange props, or create wrapper state.

Check each component's interface and implement accordingly.
  </action>
  <verify>
1. Mobile overflow menu shows: Notifications, Notes, Pinned, Members, Settings, Leave
2. Each item opens correct dialog/sheet
3. All items have min-h-11 class (44px touch target)
  </verify>
  <done>
Mobile overflow menu includes all channel actions with proper touch targets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Ensure dialogs work from dropdown selection</name>
  <files>
    src/components/channel/channel-header.tsx
    src/components/channel/notification-settings-dialog.tsx
    src/components/channel/channel-notes-sheet.tsx
    src/components/channel/pinned-messages-dialog.tsx
  </files>
  <action>
Ensure all dialogs can be opened from mobile dropdown menu:

1. Check NotificationSettingsDialog interface:
   - If it already accepts `open` and `onOpenChange`, use controlled mode
   - If not, add these props and update component to support controlled mode

2. Check ChannelNotesSheet interface:
   - If it uses Sheet with trigger, add controlled mode support
   - Add `open` and `onOpenChange` props

3. Check PinnedMessagesDialog interface:
   - Add controlled mode support if needed

For each component that needs modification, the pattern is:
```tsx
interface ComponentProps {
  // existing props
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}

export function Component({ open: controlledOpen, onOpenChange, ...props }) {
  const [internalOpen, setInternalOpen] = useState(false);
  const isControlled = controlledOpen !== undefined;
  const open = isControlled ? controlledOpen : internalOpen;
  const setOpen = isControlled ? onOpenChange! : setInternalOpen;

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      {/* If uncontrolled, render trigger */}
      {!isControlled && <DialogTrigger>...</DialogTrigger>}
      <DialogContent>...</DialogContent>
    </Dialog>
  );
}
```

In ChannelHeader, add state for each:
```tsx
const [showNotificationDialog, setShowNotificationDialog] = useState(false);
const [showNotesSheet, setShowNotesSheet] = useState(false);
const [showPinnedDialog, setShowPinnedDialog] = useState(false);
```

And render controlled versions outside the mobile menu:
```tsx
<NotificationSettingsDialog
  open={showNotificationDialog}
  onOpenChange={setShowNotificationDialog}
  channelId={channel.id}
  channelName={channel.name}
  currentMode={currentNotificationMode}
  onModeChange={setCurrentNotificationMode}
/>
```
  </action>
  <verify>
1. Tapping Notifications in mobile menu opens notification settings dialog
2. Tapping Notes opens notes sheet
3. Tapping Pinned opens pinned messages dialog
4. Each closes properly
5. State updates correctly
  </verify>
  <done>
All channel actions accessible and functional from mobile overflow menu.
  </done>
</task>

</tasks>

<verification>
1. Channel header mobile overflow menu (MoreVertical icon) visible on mobile
2. Menu contains: Notifications, Notes, Pinned, Members, Settings (if admin), Leave
3. Each menu item has 44px minimum height
4. Each action opens correct dialog/sheet
5. Desktop view unchanged (inline buttons still work)
</verification>

<success_criteria>
- MOBI2-10: Channel header actions in collapsible overflow menu
- All channel actions accessible on mobile
- 44px minimum touch targets
- No regression on desktop
</success_criteria>

<output>
After completion, create `.planning/phases/35-mobile-redesign/35-05-SUMMARY.md`
</output>
