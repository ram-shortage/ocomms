---
phase: 35-mobile-redesign
plan: 03
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - src/components/layout/mobile-tab-bar.tsx
  - src/components/mobile/mobile-more-menu.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile tab bar has 4 primary tabs plus More button"
    - "More menu opens as bottom sheet"
    - "Scheduled, Reminders, and Saved are accessible via More menu"
    - "More menu items link to correct routes"
    - "Navigation state highlights current route correctly"
  artifacts:
    - path: "src/components/mobile/mobile-more-menu.tsx"
      provides: "More menu bottom sheet"
      min_lines: 50
    - path: "src/components/layout/mobile-tab-bar.tsx"
      provides: "Updated tab bar with More button"
      contains: "MoreHorizontal"
  key_links:
    - from: "src/components/layout/mobile-tab-bar.tsx"
      to: "src/components/mobile/mobile-more-menu.tsx"
      via: "import"
      pattern: "MobileMoreMenu"
---

<objective>
Add "More" menu to mobile navigation providing access to Scheduled, Reminders, and Saved pages.

Purpose: Desktop sidebar has links to Scheduled, Reminders, and Saved, but mobile navigation doesn't. Adding a More menu with bottom sheet provides access to these features on mobile without cluttering the main tab bar.

Output: Mobile tab bar with 4 primary tabs + More button that opens a bottom sheet with secondary navigation items.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/35-mobile-redesign/35-CONTEXT.md
@.planning/phases/35-mobile-redesign/35-RESEARCH.md
@src/components/layout/mobile-tab-bar.tsx
@src/components/ui/drawer.tsx
@src/components/workspace/workspace-sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileMoreMenu component</name>
  <files>
    src/components/mobile/mobile-more-menu.tsx
  </files>
  <action>
Create a new component at src/components/mobile/mobile-more-menu.tsx:

```typescript
"use client";

import { useState } from "react";
import Link from "next/link";
import { usePathname } from "next/navigation";
import { MoreHorizontal, Clock, Bell, Bookmark, StickyNote, Settings, User } from "lucide-react";
import { cn } from "@/lib/utils";
import {
  Drawer,
  DrawerContent,
  DrawerHeader,
  DrawerTitle,
} from "@/components/ui/drawer";

interface MobileMoreMenuProps {
  workspaceSlug: string;
}

// Items in the More menu
const moreItems = [
  { href: (slug: string) => `/${slug}/scheduled`, icon: Clock, label: "Scheduled Messages" },
  { href: (slug: string) => `/${slug}/reminders`, icon: Bell, label: "Reminders" },
  { href: (slug: string) => `/${slug}/saved`, icon: Bookmark, label: "Saved Items" },
  { href: (slug: string) => `/${slug}/notes`, icon: StickyNote, label: "My Notes" },
  { href: (slug: string) => `/${slug}/settings`, icon: Settings, label: "Settings" },
];

export function MobileMoreMenu({ workspaceSlug }: MobileMoreMenuProps) {
  const pathname = usePathname();
  const [open, setOpen] = useState(false);

  // Check if any More menu route is active
  const isMoreActive = moreItems.some(item =>
    pathname.startsWith(item.href(workspaceSlug))
  );

  return (
    <>
      {/* More button - rendered by parent */}
      <button
        onClick={() => setOpen(true)}
        className={cn(
          "flex min-h-11 min-w-11 flex-col items-center justify-center gap-1 rounded-lg px-3 py-2",
          "transition-colors hover:bg-accent active:bg-accent",
          isMoreActive ? "text-primary" : "text-muted-foreground"
        )}
      >
        <MoreHorizontal className="h-5 w-5" />
        <span className="text-xs">More</span>
      </button>

      {/* More menu drawer */}
      <Drawer open={open} onOpenChange={setOpen}>
        <DrawerContent>
          <DrawerHeader>
            <DrawerTitle>More</DrawerTitle>
          </DrawerHeader>
          <nav className="px-4 pb-4 space-y-1">
            {moreItems.map(({ href, icon: Icon, label }) => {
              const itemHref = href(workspaceSlug);
              const isActive = pathname.startsWith(itemHref);

              return (
                <Link
                  key={label}
                  href={itemHref}
                  onClick={() => setOpen(false)}
                  className={cn(
                    "flex items-center gap-3 min-h-11 px-4 py-3 rounded-md transition-colors",
                    "hover:bg-accent active:bg-accent",
                    isActive && "bg-accent text-primary font-medium"
                  )}
                >
                  <Icon className="h-5 w-5 flex-shrink-0" />
                  <span>{label}</span>
                </Link>
              );
            })}
          </nav>
        </DrawerContent>
      </Drawer>
    </>
  );
}
```

Key requirements:
- 44px minimum touch targets (min-h-11 = 44px)
- Proper active state detection
- Close drawer on navigation
- Include: Scheduled, Reminders, Saved, Notes, Settings
- Match existing design patterns from sidebar
  </action>
  <verify>
1. File exists: src/components/mobile/mobile-more-menu.tsx
2. TypeScript compiles without errors
3. Component renders More button and Drawer
  </verify>
  <done>
MobileMoreMenu component created with drawer containing Scheduled, Reminders, Saved, Notes, Settings links.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update MobileTabBar with More button</name>
  <files>
    src/components/layout/mobile-tab-bar.tsx
  </files>
  <action>
Update the MobileTabBar to include the More menu:

1. Import MobileMoreMenu from "@/components/mobile/mobile-more-menu"

2. Reduce primary tabs to 4 (remove Profile, since it's in More menu via Settings):
```typescript
const tabs = [
  { href: (slug: string) => `/${slug}`, icon: Home, label: "Home" },
  { href: (slug: string) => `/${slug}/dm`, icon: MessageSquare, label: "DMs" },
  { href: (slug: string) => `/${slug}/threads`, icon: AtSign, label: "Mentions" },
  { href: (slug: string) => `/${slug}/search`, icon: Search, label: "Search" },
];
```

3. Add MobileMoreMenu as 5th item in the tab bar:
```tsx
<div className="flex h-16 items-center justify-around">
  {tabs.map(({ href, icon: Icon, label }) => (
    // ... existing tab rendering
  ))}
  <MobileMoreMenu workspaceSlug={workspaceSlug} />
</div>
```

4. Update getIsActive function to NOT highlight any primary tab when a More menu route is active (scheduled, reminders, saved, notes, settings, profile). The More button handles its own active state.

5. Ensure Profile is accessible: Profile is now under Settings in More menu. If there's a direct Profile link needed, add it to moreItems in MobileMoreMenu.
  </action>
  <verify>
1. MobileTabBar shows 4 tabs + More button
2. Tapping More opens drawer
3. Scheduled/Reminders/Saved links work
4. Active states are correct for all routes
  </verify>
  <done>
MobileTabBar updated with 4 primary tabs + More button, all navigation accessible.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix navigation state for all routes (MOBI2-12)</name>
  <files>
    src/components/layout/mobile-tab-bar.tsx
    src/components/mobile/mobile-more-menu.tsx
  </files>
  <action>
Ensure navigation state correctly reflects current route on ALL pages:

1. In MobileTabBar's getIsActive function, handle edge cases:
   - Channel subpages: /channels/[slug]/settings should highlight Home
   - DM subpages: /dm/[id] should highlight DMs
   - Thread view: /threads/[id] should highlight Mentions (if applicable)

2. In MobileMoreMenu, ensure routes are properly matched:
   - /scheduled/* highlights Scheduled
   - /reminders/* highlights Reminders
   - /saved/* highlights Saved
   - /notes/* highlights Notes
   - /settings/* highlights Settings (includes /profile as it redirects there)

3. Test these routes specifically (from STATE.md deferred testing):
   - Mobile nav highlighting across routes
   - Verify no route leaves navigation in ambiguous state

4. Add profile to More menu items if not already there:
```typescript
{ href: (slug: string) => `/${slug}/profile`, icon: User, label: "Profile" },
```
  </action>
  <verify>
1. Navigate to various routes on mobile
2. Verify correct tab/item is highlighted:
   - Home: /workspace, /workspace/channels/*
   - DMs: /workspace/dm, /workspace/dm/*
   - Mentions: /workspace/threads
   - Search: /workspace/search
   - More (items): /workspace/scheduled, /workspace/reminders, /workspace/saved, /workspace/notes, /workspace/settings, /workspace/profile
3. No route leaves all navigation unhighlighted
  </verify>
  <done>
Navigation state correctly reflects current route on all mobile pages.
  </done>
</task>

</tasks>

<verification>
1. Mobile tab bar shows: Home, DMs, Mentions, Search, More
2. Tapping More opens bottom sheet with Scheduled, Reminders, Saved, Notes, Settings, Profile
3. Each More menu item navigates correctly and closes drawer
4. Active states work for all routes
5. No route leaves navigation ambiguous
</verification>

<success_criteria>
- MOBI2-01: Scheduled messages accessible via More menu
- MOBI2-02: Reminders accessible via More menu
- MOBI2-03: Bookmarks/saved accessible via More menu
- MOBI2-12: Navigation state correct on all routes
- All touch targets are minimum 44px
</success_criteria>

<output>
After completion, create `.planning/phases/35-mobile-redesign/35-03-SUMMARY.md`
</output>
