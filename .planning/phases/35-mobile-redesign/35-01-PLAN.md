---
phase: 35-mobile-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/ui/drawer.tsx
  - src/hooks/use-long-press.ts
  - src/lib/utils.ts
autonomous: true

must_haves:
  truths:
    - "Drawer component renders bottom sheet on mobile"
    - "Long-press hook detects touch-hold gestures"
    - "Drawer has drag handle and smooth animations"
  artifacts:
    - path: "src/components/ui/drawer.tsx"
      provides: "Vaul-based Drawer component"
      min_lines: 50
    - path: "src/hooks/use-long-press.ts"
      provides: "Long-press gesture detection"
      min_lines: 30
  key_links:
    - from: "src/components/ui/drawer.tsx"
      to: "vaul"
      via: "import"
      pattern: "from ['\"]vaul['\"]"
---

<objective>
Install vaul and create foundation components for mobile bottom sheets and touch interactions.

Purpose: Provides Drawer component for mobile bottom sheets (More menu, emoji picker, action sheets) and long-press hook for touch context menus. These are required by all subsequent mobile feature plans.

Output: Drawer UI component and useLongPress hook ready for use across mobile features.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/35-mobile-redesign/35-CONTEXT.md
@.planning/phases/35-mobile-redesign/35-RESEARCH.md
@src/components/ui/sheet.tsx
@src/lib/pwa/use-is-mobile.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install vaul and add Drawer component</name>
  <files>
    package.json
    src/components/ui/drawer.tsx
  </files>
  <action>
Install vaul dependency:
```bash
npm install vaul
```

Create Drawer component based on shadcn/ui drawer pattern. The component should:
1. Export Drawer, DrawerTrigger, DrawerClose, DrawerContent, DrawerHeader, DrawerFooter, DrawerTitle, DrawerDescription
2. Use Vaul's Drawer.Root with shouldScaleBackground
3. DrawerContent should include:
   - Drag handle indicator at top (thin horizontal bar)
   - Safe area padding at bottom (pb-[env(safe-area-inset-bottom)])
   - Max height constraint (max-h-[85vh])
   - Smooth slide-up animation
4. Support snapPoints prop for half/full screen modes
5. Match existing shadcn/ui styling conventions (use cn() helper, consistent classes)

Reference the Sheet component for styling patterns but use Vaul primitives.
  </action>
  <verify>
1. `npm ls vaul` shows vaul installed
2. File exists: src/components/ui/drawer.tsx
3. Component exports are available: grep "export" src/components/ui/drawer.tsx
4. TypeScript compiles: npm run type-check (or next build --no-emit if available)
  </verify>
  <done>
Vaul installed, Drawer component created with all necessary exports, drag handle visible, safe area padding applied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useLongPress hook</name>
  <files>
    src/hooks/use-long-press.ts
  </files>
  <action>
Create a custom hook for detecting long-press gestures on touch devices:

```typescript
// src/hooks/use-long-press.ts
"use client";

import { useCallback, useRef } from "react";

interface UseLongPressOptions {
  onLongPress: () => void;
  onClick?: () => void;
  delay?: number; // Default 500ms
  threshold?: number; // Movement threshold to cancel (default 10px)
}

export function useLongPress({
  onLongPress,
  onClick,
  delay = 500,
  threshold = 10,
}: UseLongPressOptions) {
  // Implementation...
}
```

Implementation requirements:
1. Track touch start position
2. Set timeout for long-press detection (default 500ms)
3. Clear timeout if finger moves more than threshold (10px)
4. Clear timeout on touch end
5. If timeout fires before touch end, call onLongPress and optionally trigger haptic feedback (navigator.vibrate(50) if supported)
6. If touch ends before timeout without movement, call onClick if provided
7. Return object with onTouchStart, onTouchEnd, onTouchMove handlers

Do NOT use synthetic mouse events - this is touch-only. Desktop uses right-click context menus.
  </action>
  <verify>
1. File exists: src/hooks/use-long-press.ts
2. TypeScript compiles without errors
3. Exports useLongPress function
  </verify>
  <done>
useLongPress hook created with touch handlers, configurable delay and threshold, haptic feedback support.
  </done>
</task>

<task type="auto">
  <name>Task 3: Export hook from hooks index</name>
  <files>
    src/hooks/index.ts
  </files>
  <action>
Check if src/hooks/index.ts exists. If it does, add export for useLongPress:
```typescript
export { useLongPress } from "./use-long-press";
```

If it doesn't exist, create it with just the useLongPress export. The hook can also be imported directly from the file path.

Also ensure TypeScript can resolve the hook - run type check to verify imports work.
  </action>
  <verify>
1. Hook is importable: grep "useLongPress" in a test import or TypeScript check
2. npm run type-check passes (or equivalent)
  </verify>
  <done>
useLongPress hook is properly exported and importable.
  </done>
</task>

</tasks>

<verification>
1. `npm ls vaul` shows vaul ^1.x installed
2. Drawer component exists at src/components/ui/drawer.tsx with all exports
3. useLongPress hook exists at src/hooks/use-long-press.ts
4. TypeScript compiles without errors
5. No runtime errors when importing components
</verification>

<success_criteria>
- Vaul dependency installed and available
- Drawer component ready for use with mobile-optimized styling
- useLongPress hook ready for touch interactions
- Foundation in place for subsequent mobile feature plans
</success_criteria>

<output>
After completion, create `.planning/phases/35-mobile-redesign/35-01-SUMMARY.md`
</output>
