---
phase: 21-dark-mode-theming
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/providers/theme-provider.tsx
  - src/components/providers/index.ts
  - src/app/layout.tsx
  - src/components/theme-toggle.tsx
  - src/components/workspace/workspace-sidebar.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "User can toggle between light and dark mode from sidebar footer"
    - "Theme defaults to system preference on first visit"
    - "User's theme choice persists across browser sessions"
    - "Page loads without flash of wrong theme"
  artifacts:
    - path: "src/components/providers/theme-provider.tsx"
      provides: "ThemeProvider wrapping next-themes"
      exports: ["ThemeProvider"]
    - path: "src/components/theme-toggle.tsx"
      provides: "Theme toggle button component"
      exports: ["ThemeToggle"]
    - path: "src/app/layout.tsx"
      provides: "Root layout with ThemeProvider and suppressHydrationWarning"
      contains: "suppressHydrationWarning"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/providers/theme-provider.tsx"
      via: "ThemeProvider wrapping children"
      pattern: "<ThemeProvider>"
    - from: "src/components/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme\\(\\)"
    - from: "src/components/workspace/workspace-sidebar.tsx"
      to: "src/components/theme-toggle.tsx"
      via: "ThemeToggle in footer"
      pattern: "<ThemeToggle"
---

<objective>
Set up next-themes infrastructure and create theme toggle component.

Purpose: Enable light/dark mode switching with system preference default and FOUC prevention.
Output: Working theme toggle in sidebar footer that persists user preference.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-dark-mode-theming/21-CONTEXT.md
@.planning/research/STACK-v0.4.0.md (lines 115-228)

Existing files to modify:
@src/app/layout.tsx
@src/components/providers/index.ts
@src/components/workspace/workspace-sidebar.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and create ThemeProvider</name>
  <files>
    - package.json
    - src/components/providers/theme-provider.tsx
    - src/components/providers/index.ts
    - src/app/layout.tsx
  </files>
  <action>
1. Install next-themes:
   ```bash
   npm install next-themes
   ```

2. Create ThemeProvider component at src/components/providers/theme-provider.tsx:
   - "use client" directive at top
   - Import ThemeProvider as NextThemesProvider from "next-themes"
   - Export ThemeProvider that wraps children with NextThemesProvider
   - Configure: attribute="class", defaultTheme="system", enableSystem, disableTransitionOnChange

3. Update src/components/providers/index.ts to export ThemeProvider

4. Update src/app/layout.tsx:
   - Add suppressHydrationWarning to the html tag (required for next-themes to prevent hydration warnings)
   - Import ThemeProvider from "@/components/providers"
   - Wrap content with ThemeProvider (inside body, wrapping SyncProvider and children)

Note: The existing dark mode CSS variables in globals.css already use .dark class selector, which matches next-themes' attribute="class" configuration.
  </action>
  <verify>
    - npm run build succeeds without errors
    - View page source shows suppressHydrationWarning on html tag
    - localStorage shows "theme" key after page load (stores user preference)
  </verify>
  <done>
    - ThemeProvider wraps app in layout.tsx
    - suppressHydrationWarning on html tag prevents hydration warnings
    - next-themes installed and configured with system default
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeToggle and add to sidebar</name>
  <files>
    - src/components/theme-toggle.tsx
    - src/components/workspace/workspace-sidebar.tsx
  </files>
  <action>
1. Create ThemeToggle component at src/components/theme-toggle.tsx:
   - "use client" directive
   - Import useTheme from "next-themes"
   - Import Sun, Moon icons from "lucide-react"
   - Import Button from "@/components/ui/button"
   - Use useState and useEffect to handle hydration (mounted state)
   - Component shows:
     * Sun icon when theme is "dark" (clicking switches to light)
     * Moon icon when theme is "light" (clicking switches to dark)
   - On click: toggle between "light" and "dark" (not "system" - per CONTEXT.md)
   - Return null until mounted to avoid hydration mismatch
   - Style: ghost variant button, icon only, match sidebar footer styling

2. Add ThemeToggle to workspace-sidebar.tsx footer:
   - Import ThemeToggle from "@/components/theme-toggle"
   - Add ThemeToggle in the footer section (div.p-3.border-t)
   - Place it before the Sign Out button as a separate row
   - Match styling with other footer items (px-3 py-1.5 for consistency)

Per CONTEXT.md decisions:
- Icon only: sun for light mode, moon for dark mode (icon shows current state)
- Direct toggle: single click flips between modes
- No transition animation (disableTransitionOnChange handles this)
  </action>
  <verify>
    - npm run dev and navigate to workspace
    - Theme toggle appears in sidebar footer
    - Clicking toggle switches between light/dark immediately
    - Icon changes: sun in dark mode, moon in light mode
    - Refresh page - theme persists
    - Clear localStorage, refresh - defaults to system preference
  </verify>
  <done>
    - ThemeToggle component renders in sidebar footer
    - Toggle switches between light and dark modes
    - Theme persists across page refreshes (localStorage)
    - No FOUC on page load
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. Fresh incognito window: theme follows system preference
2. Click toggle: switches immediately, no transition flash
3. Refresh: theme persists
4. Open second tab: theme syncs across tabs
5. No console errors about hydration mismatch
6. Build succeeds: npm run build
</verification>

<success_criteria>
- THEME-01: User can toggle between light and dark mode via UI control (toggle in sidebar)
- THEME-02: Theme defaults to system preference (defaultTheme="system")
- THEME-03: User's theme choice persists across sessions (localStorage)
- THEME-04: No flash of wrong theme on initial page load (next-themes FOUC prevention)
</success_criteria>

<output>
After completion, create `.planning/phases/21-dark-mode-theming/21-01-SUMMARY.md`
</output>
