---
phase: 20-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - nginx/conf.d/default.conf
  - src/components/workspace/workspace-sidebar.tsx
  - src/components/auth/logout-button.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "HSTS max-age is 31536000 (1 year) in nginx config"
    - "Logout button visible in sidebar footer"
    - "Clicking logout signs user out and redirects to login"
  artifacts:
    - path: "nginx/conf.d/default.conf"
      provides: "Production HSTS header"
      contains: "max-age=31536000"
    - path: "src/components/workspace/workspace-sidebar.tsx"
      provides: "Sidebar with logout button"
      contains: "LogoutButton"
  key_links:
    - from: "src/components/workspace/workspace-sidebar.tsx"
      to: "src/components/auth/logout-button.tsx"
      via: "component import"
      pattern: "import.*LogoutButton"
---

<objective>
Complete HSTS security header update and integrate logout button into sidebar.

Purpose: Finalize production security settings and ensure users can easily sign out from any workspace view.
Output: Updated nginx config with 1-year HSTS, sidebar with logout button.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-ui-polish/20-RESEARCH.md

Key files:
@nginx/conf.d/default.conf
@src/components/workspace/workspace-sidebar.tsx
@src/components/auth/logout-button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update HSTS max-age to production value</name>
  <files>nginx/conf.d/default.conf</files>
  <action>
  Update the Strict-Transport-Security header from 3600 (1 hour) to 31536000 (1 year).

  Find line:
  ```nginx
  add_header Strict-Transport-Security "max-age=3600" always;
  ```

  Replace with:
  ```nginx
  add_header Strict-Transport-Security "max-age=31536000" always;
  ```

  DO NOT add `includeSubDomains` or `preload` flags - those require additional setup and testing.
  </action>
  <verify>
  ```bash
  grep "max-age=31536000" nginx/conf.d/default.conf
  ```
  Should return the updated HSTS line.
  </verify>
  <done>HSTS max-age is 31536000 (1 year) for production security.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate logout button into sidebar footer</name>
  <files>src/components/workspace/workspace-sidebar.tsx, src/components/auth/logout-button.tsx</files>
  <action>
  1. Import the existing LogoutButton component into workspace-sidebar.tsx

  2. Modify LogoutButton to accept optional styling props for sidebar integration:
     - Update to accept `className` and `variant` props
     - Default variant should be "ghost" for sidebar use
     - Remove the hardcoded "mt-4" margin class (let parent control spacing)

  3. Add LogoutButton to sidebar footer section:
     - Place after the "Settings" link
     - Style to match existing footer items (text style, not destructive button)
     - Use a text link appearance with "Sign Out" text

  Current footer structure:
  ```tsx
  <div className="p-3 border-t space-y-1 text-sm">
    <Link href={`/${workspace.slug}/profile`} ...>Edit Profile</Link>
    <Link href={`/${workspace.slug}/settings`} ...>Settings</Link>
    {/* Add logout here */}
  </div>
  ```

  Target appearance: Same visual style as Edit Profile and Settings links (text-based, hover state).
  </action>
  <verify>
  ```bash
  grep -l "LogoutButton" src/components/workspace/workspace-sidebar.tsx
  ```
  Should return the file path, confirming import.

  Manual verify: Visit any workspace, confirm "Sign Out" appears in sidebar footer below Settings.
  </verify>
  <done>Logout button visible in sidebar footer, matches existing link styling, signs user out on click.</done>
</task>

</tasks>

<verification>
1. `grep "max-age=31536000" nginx/conf.d/default.conf` returns match
2. `grep "LogoutButton" src/components/workspace/workspace-sidebar.tsx` shows import
3. TypeScript compiles: `npm run build` completes without errors
</verification>

<success_criteria>
- HSTS max-age set to 31536000 (UIPOL-06 complete)
- Logout button visible in sidebar footer (UIPOL-02 complete)
- Clicking logout signs out and redirects to /login
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-ui-polish/20-01-SUMMARY.md`
</output>
