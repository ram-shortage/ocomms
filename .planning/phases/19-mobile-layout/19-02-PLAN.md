---
phase: 19-mobile-layout
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - src/components/layout/mobile-tab-bar.tsx
  - src/components/layout/index.ts
  - src/app/(workspace)/[workspaceSlug]/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Bottom tab bar visible on mobile screens (< 768px)"
    - "Sidebar visible on desktop screens (>= 768px)"
    - "Bottom tabs have safe-area padding for notched devices"
    - "All tab links navigate to correct workspace routes"
    - "Current route is highlighted in tab bar"
  artifacts:
    - path: "src/components/layout/mobile-tab-bar.tsx"
      provides: "Bottom navigation component for mobile"
      exports: ["MobileTabBar"]
    - path: "src/components/layout/index.ts"
      provides: "Barrel export for layout components"
      exports: ["MobileTabBar"]
    - path: "src/app/(workspace)/[workspaceSlug]/layout.tsx"
      provides: "Responsive layout switching sidebar/tabs"
      contains: "md:hidden"
  key_links:
    - from: "src/components/layout/mobile-tab-bar.tsx"
      to: "next/link"
      via: "Link components for navigation"
      pattern: "<Link"
    - from: "src/app/(workspace)/[workspaceSlug]/layout.tsx"
      to: "src/components/layout/mobile-tab-bar.tsx"
      via: "MobileTabBar import"
      pattern: "MobileTabBar"
---

<objective>
Create bottom tab bar navigation for mobile and implement responsive layout switching.

Purpose: Provide native-like mobile navigation experience with bottom tabs, replacing the sidebar on small screens.

Output: MobileTabBar component with 5 tabs (Home, DMs, Mentions, Search, Profile), workspace layout that shows sidebar on desktop and bottom tabs on mobile.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-mobile-layout/19-RESEARCH.md
@.planning/phases/19-mobile-layout/19-01-SUMMARY.md

Reference files:
@src/app/(workspace)/[workspaceSlug]/layout.tsx
@src/components/workspace/workspace-sidebar.tsx (pattern reference)
@src/lib/utils.ts (cn utility)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileTabBar component</name>
  <files>src/components/layout/mobile-tab-bar.tsx, src/components/layout/index.ts</files>
  <action>
    Create directory src/components/layout/ if it doesn't exist.

    Create src/components/layout/mobile-tab-bar.tsx:

    ```typescript
    "use client";

    import Link from "next/link";
    import { usePathname } from "next/navigation";
    import { Home, MessageSquare, AtSign, Search, User } from "lucide-react";
    import { cn } from "@/lib/utils";

    interface MobileTabBarProps {
      workspaceSlug: string;
    }

    const tabs = [
      { href: (slug: string) => `/${slug}`, icon: Home, label: "Home" },
      { href: (slug: string) => `/${slug}/dm`, icon: MessageSquare, label: "DMs" },
      { href: (slug: string) => `/${slug}/threads`, icon: AtSign, label: "Mentions" },
      { href: (slug: string) => `/${slug}/search`, icon: Search, label: "Search" },
      { href: (slug: string) => `/${slug}/profile`, icon: User, label: "Profile" },
    ];

    export function MobileTabBar({ workspaceSlug }: MobileTabBarProps) {
      const pathname = usePathname();

      return (
        <nav
          className="fixed bottom-0 left-0 right-0 z-50 border-t bg-background
            pb-[env(safe-area-inset-bottom)]
            pl-[env(safe-area-inset-left)]
            pr-[env(safe-area-inset-right)]
            md:hidden"
        >
          <div className="flex h-16 items-center justify-around">
            {tabs.map(({ href, icon: Icon, label }) => {
              const tabHref = href(workspaceSlug);
              // Match exact path or check if we're on a subpage of the tab
              const isActive = pathname === tabHref ||
                (label === "Home" && pathname === `/${workspaceSlug}`) ||
                (label === "DMs" && pathname.startsWith(`/${workspaceSlug}/dm`)) ||
                (label === "Mentions" && pathname.startsWith(`/${workspaceSlug}/threads`)) ||
                (label === "Search" && pathname.startsWith(`/${workspaceSlug}/search`)) ||
                (label === "Profile" && pathname.startsWith(`/${workspaceSlug}/profile`));

              return (
                <Link
                  key={label}
                  href={tabHref}
                  className={cn(
                    "flex min-h-11 min-w-11 flex-col items-center justify-center gap-1 rounded-lg px-3 py-2",
                    "transition-colors hover:bg-accent active:bg-accent",
                    isActive ? "text-primary" : "text-muted-foreground"
                  )}
                >
                  <Icon className="h-5 w-5" />
                  <span className="text-xs">{label}</span>
                </Link>
              );
            })}
          </div>
        </nav>
      );
    }
    ```

    Key design decisions:
    - Uses md:hidden so it only shows on mobile (< 768px)
    - Fixed to bottom with z-50 for proper layering
    - Safe-area padding for notched devices via env(safe-area-inset-*)
    - min-h-11 min-w-11 for 44px touch targets (MOBI-03)
    - active: state for touch feedback
    - "Mentions" tab links to /threads (existing route per RESEARCH.md open question)

    Create src/components/layout/index.ts barrel:
    ```typescript
    export { MobileTabBar } from "./mobile-tab-bar";
    ```
  </action>
  <verify>
    - Component renders 5 tabs with correct icons
    - Tab links point to correct routes
    - Active tab is highlighted based on current path
    - Tab bar only visible at < 768px viewport
  </verify>
  <done>
    MobileTabBar component created with 5 tabs, safe-area padding, and 44px touch targets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update workspace layout for responsive navigation</name>
  <files>src/app/(workspace)/[workspaceSlug]/layout.tsx</files>
  <action>
    Update the workspace layout to:
    1. Import MobileTabBar from layout components
    2. Hide sidebar on mobile (md:hidden -> hidden md:flex)
    3. Add bottom padding to main content to account for tab bar height
    4. Render MobileTabBar at bottom (mobile only)

    Changes to make:

    Add import:
    ```typescript
    import { MobileTabBar } from "@/components/layout";
    ```

    Update the return JSX:
    ```tsx
    return (
      <PresenceWrapper workspaceId={workspace.id} memberUserIds={memberUserIds}>
        <div className="flex h-dvh flex-col md:flex-row">
          {/* Sidebar - desktop only */}
          <aside className="hidden md:flex md:w-64 md:flex-shrink-0">
            <WorkspaceSidebar
              workspace={{
                id: workspace.id,
                name: workspace.name,
                slug: workspaceSlug,
              }}
              currentUserId={session.user.id}
              channels={sidebarChannels}
              conversations={sidebarConversations}
            />
          </aside>

          {/* Main content - with bottom padding on mobile for tab bar */}
          <main className="flex-1 overflow-hidden pb-16 md:pb-0">
            {children}
          </main>

          {/* Bottom tabs - mobile only */}
          <MobileTabBar workspaceSlug={workspaceSlug} />
        </div>
      </PresenceWrapper>
    );
    ```

    Key changes:
    - flex-col md:flex-row: Stack vertically on mobile, horizontal on desktop
    - hidden md:flex on sidebar: Only show sidebar on desktop
    - pb-16 md:pb-0 on main: Reserve space for tab bar on mobile (h-16 = 64px)
    - MobileTabBar has md:hidden built-in so no wrapper needed

    Note: WorkspaceSidebar needs to be wrapped in aside since the component
    returns the outer element. Check WorkspaceSidebar's outer element class and
    preserve the w-64 border-r styling.

    Actually, looking at WorkspaceSidebar, it returns an <aside> with w-64.
    So wrap it differently:

    ```tsx
    {/* Sidebar - desktop only */}
    <div className="hidden md:block">
      <WorkspaceSidebar
        workspace={{
          id: workspace.id,
          name: workspace.name,
          slug: workspaceSlug,
        }}
        currentUserId={session.user.id}
        channels={sidebarChannels}
        conversations={sidebarConversations}
      />
    </div>
    ```
  </action>
  <verify>
    - On desktop (>= 768px): Sidebar visible, bottom tabs hidden
    - On mobile (< 768px): Sidebar hidden, bottom tabs visible
    - Main content doesn't overlap with tab bar on mobile
    - Navigation links in both sidebar and tabs work correctly
  </verify>
  <done>
    Workspace layout shows sidebar on desktop, bottom tabs on mobile.
    Main content has proper padding to avoid tab bar overlap.
  </done>
</task>

</tasks>

<verification>
1. Mobile viewport (< 768px):
   - Sidebar is NOT visible
   - Bottom tab bar IS visible with 5 tabs
   - All tab icons and labels display correctly
   - Tapping tabs navigates to correct routes
   - Current route's tab is highlighted
   - Content doesn't go under tab bar

2. Desktop viewport (>= 768px):
   - Sidebar IS visible
   - Bottom tab bar is NOT visible
   - All sidebar navigation works as before

3. On device with notch (iPhone X+):
   - Tab bar respects safe-area-inset-bottom (content not under home indicator)

4. Touch targets:
   - Tab buttons are at least 44x44 pixels (inspect element to verify)

5. Build passes:
   - `npm run build` completes without errors
</verification>

<success_criteria>
- MOBI-01: Bottom tab bar visible on mobile with Home, DMs, Mentions, Search, Profile
- MOBI-02: Layout adapts correctly - sidebar on desktop, tabs on mobile
- Tab navigation works correctly with proper active state highlighting
- Safe-area insets respected on notched devices
- No visual overlap between content and navigation elements
</success_criteria>

<output>
After completion, create `.planning/phases/19-mobile-layout/19-02-SUMMARY.md`
</output>
