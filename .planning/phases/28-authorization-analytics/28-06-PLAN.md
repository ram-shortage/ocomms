---
phase: 28-authorization-analytics
plan: 06
type: execute
wave: 3
depends_on: ["28-04"]
files_modified:
  - src/app/(workspace)/[workspaceSlug]/settings/guests/page.tsx
  - src/components/guest/guest-list.tsx
  - src/components/guest/guest-invite-dialog.tsx
  - src/components/guest/guest-badge.tsx
  - src/app/join/[token]/page.tsx
  - src/components/profile/profile-card.tsx
  - src/components/member/member-list-item.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can see guest management page in settings"
    - "Admin can create guest invite links for specific channels"
    - "Admin can view, extend, and remove guest access"
    - "Guest badge visible on profiles and member lists (GUST-03)"
    - "Invite link redemption creates guest account with channel access"
  artifacts:
    - path: "src/app/(workspace)/[workspaceSlug]/settings/guests/page.tsx"
      provides: "Guest management settings page"
      contains: "GuestList"
    - path: "src/components/guest/guest-invite-dialog.tsx"
      provides: "Dialog for creating guest invites"
      exports: ["GuestInviteDialog"]
    - path: "src/components/guest/guest-badge.tsx"
      provides: "Guest badge component"
      exports: ["GuestBadge"]
    - path: "src/app/join/[token]/page.tsx"
      provides: "Guest invite redemption page"
      contains: "redeemGuestInvite"
  key_links:
    - from: "src/app/(workspace)/[workspaceSlug]/settings/guests/page.tsx"
      to: "src/lib/actions/guest.ts"
      via: "server action calls"
      pattern: "getWorkspaceGuests|createGuestInvite"
    - from: "src/app/join/[token]/page.tsx"
      to: "src/lib/actions/guest.ts"
      via: "invite redemption"
      pattern: "redeemGuestInvite"
---

<objective>
Create guest management admin UI and guest badge components.

Purpose: Admin interface for inviting and managing guests, badge display throughout app, and invite redemption flow.

Output: Guest settings page, invite dialog, badge component, join page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/28-authorization-analytics/28-CONTEXT.md
@.planning/phases/28-authorization-analytics/28-04-SUMMARY.md
@src/app/(workspace)/[workspaceSlug]/settings/admin/page.tsx
@src/components/profile/profile-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create guest management settings page</name>
  <files>src/app/(workspace)/[workspaceSlug]/settings/guests/page.tsx, src/components/guest/guest-list.tsx, src/components/guest/guest-invite-dialog.tsx</files>
  <action>
Create admin-only guest management page.

**src/app/(workspace)/[workspaceSlug]/settings/guests/page.tsx:**
- Admin access check
- Two sections: "Active Guests" and "Invite Links"
- Title: "Guest Management"

**src/components/guest/guest-list.tsx:**
- Table of active guests: Name, Email, Channels, Expires, Status, Actions
- Status: Active, Expiring Soon (< 7 days), Expired (soft locked)
- Actions: Extend, Remove, View Channels
- Extend opens date picker to set new expiration
- Remove shows confirmation dialog
- Filter/search by name or email
- Empty state: "No guests in this workspace"

**src/components/guest/guest-invite-dialog.tsx:**
- Dialog/Sheet for creating invite
- Multi-select for channels (required, at least 1)
- Optional: Guest expiration date picker
- Generate button creates link
- Display generated link with copy button
- Link format: `{baseUrl}/join/{token}`
- "Create Another" button after generation

Also show list of existing invite links:
- Token (masked), Created by, Channels, Used by, Created at
- Revoke button to invalidate unused invites
  </action>
  <verify>
Navigate to /[workspace]/settings/guests as admin.
Create invite, copy link.
See guest list after redemption.
Extend and remove guest works.
  </verify>
  <done>Guest management settings page with invite creation and guest list</done>
</task>

<task type="auto">
  <name>Task 2: Create guest invite redemption flow</name>
  <files>src/app/join/[token]/page.tsx</files>
  <action>
Create the page that handles guest invite links.

**src/app/join/[token]/page.tsx:**

Flow:
1. Extract token from URL
2. Validate invite (exists, not used, not expired)
3. If invalid: Show error "This invite link is invalid or has expired"
4. If valid:
   a. If user logged in: Show welcome page with workspace/channel info, "Join as Guest" button
   b. If not logged in: Redirect to sign up/sign in, then back here

**Welcome page content:**
- Workspace name and logo
- "You've been invited as a guest"
- List of channels you'll have access to
- Expiration info if set: "Your access will expire on [date]"
- "Join Workspace" button

**On "Join" click:**
- Call redeemGuestInvite(token)
- If success: Redirect to workspace with welcome modal
- If error: Show error message

**Guest welcome modal (show on first visit):**
Per CONTEXT.md: Welcome modal explaining guest access limits
- "Welcome to [Workspace]!"
- "As a guest, you have access to: [channels]"
- "You can send messages, react, and upload files in these channels"
- "Note: You cannot access other channels or start new conversations"
- "Got it" button dismisses (store in localStorage)
  </action>
  <verify>
Visit /join/[valid-token], see welcome page.
Click Join, account created as guest.
Welcome modal shows on first workspace visit.
Invalid token shows error.
  </verify>
  <done>Guest invite redemption with welcome flow</done>
</task>

<task type="auto">
  <name>Task 3: Add guest badge throughout app</name>
  <files>src/components/guest/guest-badge.tsx, src/components/profile/profile-card.tsx, src/components/member/member-list-item.tsx, relevant message header components</files>
  <action>
GUST-03: Guest badge visible on profiles, member lists, message headers, mentions.

**Create src/components/guest/guest-badge.tsx:**
```typescript
export function GuestBadge({ className }: { className?: string }) {
  return (
    <span className={cn(
      "inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium",
      "bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200",
      className
    )}>
      Guest
    </span>
  );
}
```

Small, subtle but visible. Amber color distinguishes from other badges.

**Update profile-card.tsx:**
- Check if member.isGuest
- Show GuestBadge next to name
- For guest viewing other profiles: Show limited info (name, avatar only - no email per CONTEXT.md)

**Update member-list-item.tsx:**
- Check if member.isGuest
- Show GuestBadge inline with name

**Update message header/author display:**
- Find where message author name is rendered
- Add GuestBadge if author is guest
- May need to pass isGuest through message data

**In mention rendering (mentions.ts or message-content.tsx):**
- When rendering @user mention for a guest, could add badge
- Optional - may be too cluttered. Use discretion.

GUST-06 consideration: When guest views member list, only show members from their allowed channels. This may already be handled in Plan 04, but verify the UI respects it.
  </action>
  <verify>
Guest badge appears on guest profiles.
Guest badge appears in member lists.
Guest badge appears in message headers.
Guest sees limited profile info for others.
  </verify>
  <done>Guest badge visible throughout app per GUST-03</done>
</task>

</tasks>

<verification>
- [ ] Guest settings page accessible to admins
- [ ] Can create invite link with channel selection
- [ ] Invite link can be copied
- [ ] Join page validates and redeems invite
- [ ] Guest account created with correct channel access
- [ ] Welcome modal explains guest limits
- [ ] Guest badge visible on profiles
- [ ] Guest badge visible in member lists
- [ ] Guest badge visible in message headers
- [ ] Admin can extend guest expiration
- [ ] Admin can remove guest access
</verification>

<success_criteria>
Guest UI complete:
- Admin management interface for invites and guests
- Shareable invite link flow
- Guest badge visible everywhere
- Welcome experience for new guests
</success_criteria>

<output>
After completion, create `.planning/phases/28-authorization-analytics/28-06-SUMMARY.md`
</output>
