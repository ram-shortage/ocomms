---
phase: 36-stabilization
plan: 04
type: execute
wave: 2
depends_on: ["36-01"]
files_modified:
  - e2e/tests/mobile/navigation.spec.ts
  - e2e/tests/mobile/features.spec.ts
  - e2e/tests/regression/core-flows.spec.ts
  - e2e/tests/regression/realtime.spec.ts
autonomous: true

must_haves:
  truths:
    - "Mobile navigation correctly accesses all features"
    - "Touch targets meet 44px minimum size"
    - "Core messaging flows work end-to-end"
    - "Realtime sync works between multiple users"
  artifacts:
    - path: "e2e/tests/mobile/navigation.spec.ts"
      provides: "Mobile navigation tests"
      contains: "mobile"
    - path: "e2e/tests/mobile/features.spec.ts"
      provides: "Mobile feature accessibility tests"
      contains: "MOBI"
    - path: "e2e/tests/regression/core-flows.spec.ts"
      provides: "Core v0.5.0 regression tests"
      contains: "message"
    - path: "e2e/tests/regression/realtime.spec.ts"
      provides: "Realtime multi-user tests"
      contains: "context"
  key_links:
    - from: "e2e/tests/mobile/navigation.spec.ts"
      to: "playwright.config.ts"
      via: "mobile project"
      pattern: "mobile.*chrome"
    - from: "e2e/tests/regression/realtime.spec.ts"
      to: "multi-browser context"
      via: "browser.newContext"
      pattern: "newContext"
---

<objective>
Verify mobile redesign features (MOBI2-*) and ensure no v0.5.0 regressions.

Purpose: Ensure mobile accessibility, touch targets, and visual polish from Phase 35 work correctly. Also verify core messaging flows that existed in v0.5.0 still work (regression testing).

Output: Mobile E2E tests and core functionality regression tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/phases/36-stabilization/36-01-SUMMARY.md

# Mobile components
@src/components/mobile/mobile-nav.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mobile Navigation and Feature Accessibility Tests</name>
  <files>
    e2e/tests/mobile/navigation.spec.ts
    e2e/tests/mobile/features.spec.ts
    e2e/pages/mobile-nav.page.ts
  </files>
  <action>
Create mobile-specific tests using Playwright's mobile device emulation:

1. Create `e2e/pages/mobile-nav.page.ts`:
   - MobileNavPage class
   - Locators: bottomTabBar, moreMenu, homeTab, dmTab, searchTab
   - Methods: openMoreMenu(), navigateTo(tab), getCurrentTab()

2. Create `e2e/tests/mobile/navigation.spec.ts` (runs only in mobile projects):
   - Test: "bottom tab bar displays on mobile" (implicit)
     - Navigate to workspace
     - Verify bottom tab bar visible
     - Verify desktop sidebar NOT visible

   - Test: "mobile navigation highlights current route" (MOBI2-12)
     - Navigate to home tab
     - Verify home tab highlighted
     - Navigate to DMs
     - Verify DM tab highlighted
     - Navigate to search
     - Verify search tab highlighted

   - Test: "More menu provides access to additional features" (MOBI2-01, -02, -03)
     - Open More menu
     - Verify Scheduled messages option visible
     - Verify Reminders option visible
     - Verify Saved items option visible
     - Click each, verify navigation works

   - Test: "channel header uses overflow menu on mobile" (MOBI2-10)
     - Navigate to channel
     - Verify header actions in collapsible menu (not all inline)
     - Open overflow menu, verify actions accessible

3. Create `e2e/tests/mobile/features.spec.ts`:
   - Test: "user status can be set from mobile" (MOBI2-04)
     - Access profile or header status control
     - Set custom status
     - Verify status displayed

   - Test: "emoji picker works on mobile" (MOBI2-05)
     - Go to message input
     - Open emoji picker
     - Verify picker displays with touch-friendly layout
     - Select emoji, verify inserted

   - Test: "workspace analytics viewable on mobile" (MOBI2-08)
     - Navigate to workspace analytics (admin user)
     - Verify charts display responsively
     - Verify no horizontal overflow

   - Test: "touch targets meet minimum size" (MOBI2-09)
     - Get key interactive elements (buttons, links)
     - Measure bounding box of each
     - Verify width >= 44px and height >= 44px
     - Log any violations

   - Test: "consistent spacing across mobile views" (MOBI2-11)
     - Navigate to several pages (home, DMs, profile)
     - Visual verification: no cramped layouts, proper padding
     - Note: May use screenshot comparison or visual inspection
  </action>
  <verify>
`npm run test:e2e -- --project=mobile-chrome tests/mobile/` passes
  </verify>
  <done>
Mobile navigation, feature access, and visual polish verified
  </done>
</task>

<task type="auto">
  <name>Task 2: Core Flows and Realtime Regression Tests</name>
  <files>
    e2e/tests/regression/core-flows.spec.ts
    e2e/tests/regression/realtime.spec.ts
  </files>
  <action>
Create regression tests to ensure v0.5.0 functionality still works:

1. Create `e2e/tests/regression/core-flows.spec.ts`:
   - Test: "user can sign in and access workspace"
     - Navigate to sign-in
     - Enter credentials
     - Submit form
     - Verify redirected to workspace
     - Verify sidebar and content load

   - Test: "user can send and receive messages"
     - Navigate to channel
     - Type message in input
     - Send message (Enter key or button)
     - Verify message appears in list
     - Verify message persists after refresh

   - Test: "user can create and reply to threads"
     - Find existing message
     - Click thread/reply icon
     - Send thread reply
     - Verify thread shows reply count

   - Test: "user can send direct messages"
     - Navigate to DM with another user
     - Send message
     - Verify message appears

   - Test: "user can react to messages"
     - Find message
     - Add reaction
     - Verify reaction appears
     - Click same reaction to remove
     - Verify reaction removed

   - Test: "user can search messages"
     - Go to search
     - Enter search query
     - Verify results display
     - Click result, verify navigation

2. Create `e2e/tests/regression/realtime.spec.ts`:
   - Test: "message sent by user A appears for user B" (multi-context)
     - Context A: Alice logged in
     - Context B: Bob logged in
     - Both navigate to same channel
     - Alice sends message
     - Verify message appears in Bob's view (within 5s)

   - Test: "typing indicator shows when other user types"
     - Context A: Alice types (focus input)
     - Context B: Bob sees typing indicator
     - Alice stops typing
     - Typing indicator disappears

   - Test: "reaction added by user A appears for user B"
     - Both in same channel
     - Alice adds reaction to message
     - Verify Bob sees reaction update

   - Test: "workspace unread updates in realtime"
     - Alice in workspace A, Bob in workspace B (same org)
     - Bob sends message to channel Alice can see
     - Verify Alice's workspace switcher shows unread update

Use multi-browser context pattern:
```typescript
test('realtime message sync', async ({ browser }) => {
  const alice = await browser.newContext({ storageState: 'e2e/.auth/alice.json' });
  const bob = await browser.newContext({ storageState: 'e2e/.auth/bob.json' });
  // ...
});
```

Note: May need multiple auth states. Could modify setup to create alice.json and bob.json.
  </action>
  <verify>
`npm run test:e2e -- tests/regression/` passes
  </verify>
  <done>
All core flows work, realtime sync between users verified
  </done>
</task>

</tasks>

<verification>
Run all mobile and regression tests:
```bash
# Mobile tests on mobile projects only
npm run test:e2e -- --project=mobile-chrome --project=mobile-safari tests/mobile/

# Regression tests on desktop
npm run test:e2e -- --project=chromium tests/regression/
```

Requirements coverage:
- MOBI2-01: Scheduled messages access (navigation.spec.ts)
- MOBI2-02: Reminders access (navigation.spec.ts)
- MOBI2-03: Bookmarks access (navigation.spec.ts)
- MOBI2-04: Mobile status (features.spec.ts)
- MOBI2-05: Mobile emoji picker (features.spec.ts)
- MOBI2-08: Mobile analytics (features.spec.ts)
- MOBI2-09: Touch targets (features.spec.ts)
- MOBI2-10: Header overflow menu (navigation.spec.ts)
- MOBI2-11: Consistent spacing (features.spec.ts)
- MOBI2-12: Nav route highlighting (navigation.spec.ts)

Regression tests verify v0.5.0 didn't break.
</verification>

<success_criteria>
- Mobile navigation tests pass on Pixel 5 and iPhone 13 emulation
- All mobile features accessible from navigation
- Touch targets verified >= 44px
- Core messaging flows work
- Realtime sync verified between multiple users
- No regression in v0.5.0 functionality
</success_criteria>

<output>
After completion, create `.planning/phases/36-stabilization/36-04-SUMMARY.md`
</output>
