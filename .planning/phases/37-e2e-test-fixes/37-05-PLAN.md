---
phase: 37-e2e-test-fixes
plan: 05
type: execute
wave: 3
depends_on: ["37-01", "37-03", "37-04"]
files_modified:
  - e2e/tests/mobile/features.spec.ts
  - e2e/tests/mobile/navigation.spec.ts
autonomous: true

must_haves:
  truths:
    - "Mobile feature tests pass on Chrome and Safari emulators"
    - "Mobile navigation tests pass"
    - "Touch targets meet minimum size requirements"
  artifacts:
    - path: "e2e/tests/mobile/features.spec.ts"
      provides: "Mobile features E2E tests"
    - path: "e2e/tests/mobile/navigation.spec.ts"
      provides: "Mobile navigation E2E tests"
---

<objective>
Fix mobile E2E tests (features, navigation) to work with demo-seed data.

Purpose: Mobile tests verify MOBI2-* requirements including responsive navigation, touch targets, and mobile-specific features. Tests run on both mobile-chrome (Pixel 5) and mobile-safari (iPhone 13) emulators.

Output: All 30 mobile tests passing (15 tests × 2 browsers).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/37-e2e-test-fixes/37-CONTEXT.md
@e2e/tests/mobile/features.spec.ts
@e2e/tests/mobile/navigation.spec.ts
@e2e/playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Mobile Navigation Tests</name>
  <files>
    e2e/tests/mobile/navigation.spec.ts
  </files>
  <action>
Fix all navigation tests (6 tests × 2 browsers = 12):

1. `bottom tab bar displays on mobile` (line 27):
   - Verify mobile bottom navigation bar exists
   - Check for Home, Search, Activity, More tabs

2. `mobile navigation highlights current route` (line 45):
   - Navigate to different tabs
   - Verify active tab is visually highlighted

3. `More menu provides access to additional features` (line 76):
   - Tap More tab
   - Verify menu shows Scheduled, Reminders, Saved
   - Test navigation to each

4. `channel header uses overflow menu on mobile` (line 110):
   - Navigate to a channel
   - Verify header actions in overflow menu (not inline)

5. `navigation to channel keeps home tab active` (line 146):
   - From home, tap a channel
   - Verify Home tab remains highlighted

6. `More menu shows current status section` (line 161):
   - Open More menu
   - Verify user status is displayed
   - Verify can change status from here

Mobile-specific selectors:
- Bottom nav: `[data-testid="mobile-nav"]` or `nav[aria-label="mobile navigation"]`
- Tab buttons: role="tab" or similar
- More menu: dialog/sheet component
  </action>
  <verify>
```bash
npm run test:e2e:demo -- e2e/tests/mobile/navigation.spec.ts
```
  </verify>
  <done>
All navigation tests pass on both mobile-chrome and mobile-safari
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Mobile Features Tests - Part 1</name>
  <files>
    e2e/tests/mobile/features.spec.ts
  </files>
  <action>
Fix feature tests (first 5 of 9):

1. `user status can be set from mobile` (line 29):
   - Navigate to More menu
   - Find status editor
   - Set/change status
   - Verify status updates

2. `emoji picker works on mobile` (line 58):
   - Open message composer
   - Tap emoji button
   - Verify emoji picker displays in mobile format
   - Select emoji

3. `workspace analytics viewable on mobile` (line 91):
   - Navigate to Settings > Analytics
   - Verify charts render on mobile viewport
   - Check responsive layout

4. `touch targets meet minimum size` (line 116):
   - Find interactive elements (buttons, links)
   - Verify each is at least 44x44 pixels
   - Test with:
```typescript
const button = page.locator('button').first();
const box = await button.boundingBox();
expect(box.width).toBeGreaterThanOrEqual(44);
expect(box.height).toBeGreaterThanOrEqual(44);
```

5. `consistent spacing across mobile views` (line 163):
   - Navigate to different pages
   - Verify consistent padding/margins
   - Check no content clipping
  </action>
  <verify>
```bash
npm run test:e2e:demo -- --grep "user status can be set|emoji picker|workspace analytics|touch targets|consistent spacing"
```
  </verify>
  <done>
First 5 mobile feature tests pass
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix Mobile Features Tests - Part 2</name>
  <files>
    e2e/tests/mobile/features.spec.ts
  </files>
  <action>
Fix remaining feature tests (4 of 9):

6. `user groups manageable from mobile` (line 198):
   - Navigate to Settings > User Groups
   - Verify list displays
   - Test create/edit if applicable

7. `guest management accessible from mobile` (line 226):
   - Navigate to Settings > Guests
   - Verify guest list displays
   - Check invite flow works on mobile

8. `profile page accessible and responsive` (line 256):
   - Navigate to user profile
   - Verify all sections display properly
   - Check no horizontal scrolling

9. `channel list touch targets on home` (line 280):
   - From home page
   - Verify channel items are touch-friendly
   - Test tapping channels
  </action>
  <verify>
```bash
npm run test:e2e:demo -- --grep "user groups manageable|guest management|profile page|channel list touch"
```
  </verify>
  <done>
All mobile feature tests pass
  </done>
</task>

<task type="auto">
  <name>Task 4: Run All Mobile Tests</name>
  <files>
    e2e/tests/mobile/*.spec.ts
  </files>
  <action>
Run complete mobile test suite on both browsers:

```bash
npm run test:e2e:demo -- e2e/tests/mobile/
```

This runs:
- 15 tests on mobile-chrome (Pixel 5)
- 15 tests on mobile-safari (iPhone 13)
- Total: 30 test runs

Address any remaining failures, paying attention to:
- Browser-specific issues (Safari vs Chrome)
- Viewport size differences
- Touch event handling differences
  </action>
  <verify>
All mobile tests pass (30 total runs)
  </verify>
  <done>
Mobile test suite passes completely on both emulators
  </done>
</task>

</tasks>

<verification>
Navigation Tests (× 2 browsers):
- [ ] bottom tab bar displays on mobile
- [ ] mobile navigation highlights current route
- [ ] More menu provides access to additional features
- [ ] channel header uses overflow menu on mobile
- [ ] navigation to channel keeps home tab active
- [ ] More menu shows current status section

Feature Tests (× 2 browsers):
- [ ] user status can be set from mobile
- [ ] emoji picker works on mobile
- [ ] workspace analytics viewable on mobile
- [ ] touch targets meet minimum size
- [ ] consistent spacing across mobile views
- [ ] user groups manageable from mobile
- [ ] guest management accessible from mobile
- [ ] profile page accessible and responsive
- [ ] channel list touch targets on home
</verification>

<success_criteria>
- All 30 mobile E2E test runs pass (15 tests × 2 browsers)
- Tests work consistently on both Chrome and Safari emulators
- Touch interactions work reliably
- No viewport-specific layout issues
</success_criteria>

<output>
After completion, create `.planning/phases/37-e2e-test-fixes/37-05-SUMMARY.md`
</output>
