---
phase: 37-e2e-test-fixes
plan: 04
type: execute
wave: 2
depends_on: ["37-01"]
files_modified:
  - e2e/tests/sidebar/drag-drop.spec.ts
  - e2e/tests/sidebar/sections.spec.ts
autonomous: true

must_haves:
  truths:
    - "Sidebar section tests pass"
    - "Drag-drop reordering tests pass"
    - "Channel navigation works correctly"
  artifacts:
    - path: "e2e/tests/sidebar/drag-drop.spec.ts"
      provides: "Sidebar drag-drop E2E tests"
    - path: "e2e/tests/sidebar/sections.spec.ts"
      provides: "Sidebar sections E2E tests"
---

<objective>
Fix sidebar E2E tests (drag-drop, sections) to work with demo-seed data.

Purpose: Sidebar tests verify SIDE-* requirements including drag-drop reordering of channels, categories, DMs, and sections.

Output: All 9 sidebar tests passing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/37-e2e-test-fixes/37-CONTEXT.md
@e2e/tests/sidebar/drag-drop.spec.ts
@e2e/tests/sidebar/sections.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Sidebar Sections Tests</name>
  <files>
    e2e/tests/sidebar/sections.spec.ts
  </files>
  <action>
Fix all sections tests (4 tests):

1. `sidebar shows expected sections` (line 12):
   - Verify Channels section exists
   - Verify Direct Messages section exists
   - Check for other sections (Starred, etc.)

2. `channels section shows workspace channels` (line 35):
   - Expand Channels section
   - Verify channel list displays
   - Demo-seed: Each workspace has multiple channels

3. `direct messages section shows conversations` (line 55):
   - Expand DMs section
   - Verify DM conversations display
   - Demo-seed: Users have DM history

4. `clicking channel navigates to it` (line 74):
   - Click a channel name
   - Verify URL changes to channel route
   - Verify channel content loads

Selector considerations:
- Sidebar container: `[data-testid="sidebar"]` or similar
- Section headers: collapsible headers for Channels, DMs
- Channel items: links or buttons with channel names
  </action>
  <verify>
```bash
npm run test:e2e:demo -- e2e/tests/sidebar/sections.spec.ts
```
  </verify>
  <done>
All sections tests pass (4 tests)
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Drag-Drop Tests</name>
  <files>
    e2e/tests/sidebar/drag-drop.spec.ts
  </files>
  <action>
Fix all drag-drop tests (5 tests):

1. `can drag channel to different category` (line 27):
   - Identify channel draggable element
   - Identify target category drop zone
   - Use Playwright's drag-and-drop API
   - Verify channel moved to new category

2. `can reorder channels within category` (line 63):
   - Drag channel up or down within same category
   - Verify order changed

3. `can reorder DM conversations` (line 100):
   - Drag DM conversation in list
   - Verify order persists

4. `can reorder sidebar sections` (line 131):
   - Drag section header (Channels, DMs)
   - Verify section order changes

5. `can reorder categories` (line 166):
   - Drag category header
   - Verify category order changes

Playwright drag-drop:
```typescript
await page.locator('.draggable-channel').first().dragTo(
  page.locator('.category-dropzone').nth(1)
);
```

dnd-kit considerations:
- May have specific data attributes for drag handles
- Check for `data-rbd-draggable-id` or similar
- Verify animations complete before asserting
  </action>
  <verify>
```bash
npm run test:e2e:demo -- e2e/tests/sidebar/drag-drop.spec.ts
```
  </verify>
  <done>
All drag-drop tests pass (5 tests)
  </done>
</task>

<task type="auto">
  <name>Task 3: Run All Sidebar Tests</name>
  <files>
    e2e/tests/sidebar/*.spec.ts
  </files>
  <action>
Run complete sidebar test suite:

```bash
npm run test:e2e:demo -- e2e/tests/sidebar/
```

Address any remaining failures and ensure all 9 tests pass.
  </action>
  <verify>
All sidebar tests pass (9 total)
  </verify>
  <done>
Sidebar test suite passes completely
  </done>
</task>

</tasks>

<verification>
Sections Tests:
- [ ] sidebar shows expected sections
- [ ] channels section shows workspace channels
- [ ] direct messages section shows conversations
- [ ] clicking channel navigates to it

Drag-Drop Tests:
- [ ] can drag channel to different category
- [ ] can reorder channels within category
- [ ] can reorder DM conversations
- [ ] can reorder sidebar sections
- [ ] can reorder categories
</verification>

<success_criteria>
- All 9 sidebar E2E tests pass
- Drag-drop works reliably (no flakiness)
- Tests work with demo-seed's channel/category structure
</success_criteria>

<output>
After completion, create `.planning/phases/37-e2e-test-fixes/37-04-SUMMARY.md`
</output>
