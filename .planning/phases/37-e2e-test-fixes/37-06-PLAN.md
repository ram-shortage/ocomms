---
phase: 37-e2e-test-fixes
plan: 06
type: verify
wave: 4
depends_on: ["37-01", "37-02", "37-03", "37-04", "37-05", "37-07"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All 113 E2E tests pass with demo-seed data"
    - "No flaky tests"
    - "Test suite completes in reasonable time"
---

<objective>
Final verification that all E2E tests pass with demo-seed data.

Purpose: Confirm Phase 37 is complete by running the full test suite and verifying all tests pass consistently.

Output: All 113 E2E tests passing, phase marked complete.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/37-e2e-test-fixes/37-CONTEXT.md
@.planning/phases/37-e2e-test-fixes/37-01-SUMMARY.md
@.planning/phases/37-e2e-test-fixes/37-02-SUMMARY.md
@.planning/phases/37-e2e-test-fixes/37-03-SUMMARY.md
@.planning/phases/37-e2e-test-fixes/37-04-SUMMARY.md
@.planning/phases/37-e2e-test-fixes/37-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run Full E2E Test Suite</name>
  <files>
    e2e/tests/**/*.spec.ts
  </files>
  <action>
Run the complete E2E test suite with demo-seed:

1. Ensure test environment is running:
```bash
docker compose -f docker-compose.test.yml ps
# Should show db and redis healthy
```

2. Ensure app is running with demo-seed:
```bash
# If not running, start fresh:
docker compose -f docker-compose.test.yml down
docker compose -f docker-compose.test.yml up -d db redis
sleep 5
DATABASE_URL="postgresql://postgres:test_password_123@localhost:5433/ocomms_test" npx drizzle-kit migrate
DATABASE_URL="postgresql://postgres:test_password_123@localhost:5433/ocomms_test" npm run db:demo-seed
DATABASE_URL="postgresql://postgres:test_password_123@localhost:5433/ocomms_test" REDIS_URL="redis://localhost:6380" npm run dev &
```

3. Run full test suite:
```bash
npm run test:e2e:demo
```

4. Capture results:
- Total tests
- Passed
- Failed
- Skipped
- Duration
  </action>
  <verify>
All 113 tests pass
  </verify>
  <done>
Full test suite run completed with results captured
  </done>
</task>

<task type="auto">
  <name>Task 2: Run Suite Again to Check for Flakiness</name>
  <files>
    e2e/tests/**/*.spec.ts
  </files>
  <action>
Run the test suite a second time to verify no flaky tests:

```bash
npm run test:e2e:demo
```

Compare results with first run:
- Same number of passes/fails
- No tests that passed once but failed another time

If any flaky tests found:
- Document them
- Add explicit waits or fix root cause
- Re-run until consistent
  </action>
  <verify>
Second run matches first run (no flakiness)
  </verify>
  <done>
Test suite is stable and not flaky
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Phase 37 E2E test fixes including:
- Core flow test selector updates
- Security test fixes (MFA, session, headers)
- Workspace test fixes (discovery, switcher)
- Sidebar test fixes (sections, drag-drop)
- Mobile test fixes (navigation, features)
  </what-built>
  <how-to-verify>
1. Run full E2E test suite:
   ```bash
   npm run test:e2e:demo
   ```

2. Verify all 113 tests pass

3. Optional: View HTML report:
   ```bash
   npx playwright show-report
   ```

4. Spot-check a few tests manually if desired

5. Confirm test suite runs in reasonable time (~3-5 minutes)
  </how-to-verify>
  <resume-signal>
Type "approved" to mark Phase 37 complete, or describe any remaining issues
  </resume-signal>
</task>

</tasks>

<verification>
- [ ] Full E2E suite passes (113 tests)
- [ ] No flaky tests (consistent across multiple runs)
- [ ] Test duration reasonable (< 5 minutes)
- [ ] All test categories pass:
  - [ ] Auth setup (2 tests)
  - [ ] Core flows (6 tests)
  - [ ] Security (12 tests)
  - [ ] Workspace (14 tests)
  - [ ] Sidebar (9 tests)
  - [ ] Mobile (30 tests Ã— 2 browsers)
  - [ ] Other/skipped (as applicable)
- [ ] Code review fixes (37-07):
  - [ ] Export API filters DMs by organization
  - [ ] Destructive scripts have production safety gates
  - [ ] E2E seed is idempotent
  - [ ] Socket rate limiting uses Redis
  - [ ] Link preview has response size limit
  - [ ] Restore script reports errors properly
</verification>

<success_criteria>
- All 113 E2E tests pass with demo-seed data
- Test suite is reliable (no flakiness)
- All HIGH/MEDIUM code review issues fixed
- Human verification confirms all fixes are complete
- Phase 37 can be marked as complete
</success_criteria>

<output>
After completion, create `.planning/phases/37-e2e-test-fixes/37-VERIFICATION.md`
</output>
