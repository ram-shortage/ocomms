---
phase: 13-audit-logging
plan: 04
type: execute
wave: 3
depends_on: ["13-02", "13-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Login attempts visible in audit log"
    - "Admin actions visible in audit log"
    - "Logs queryable via API"
  artifacts: []
  key_links: []
---

<objective>
Verify audit logging meets SEC-06 requirements

Purpose: Confirm all security events are being logged and queryable
Output: Verified working audit logging system
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/13-audit-logging/13-CONTEXT.md
@.planning/phases/13-audit-logging/13-01-SUMMARY.md
@.planning/phases/13-audit-logging/13-02-SUMMARY.md
@.planning/phases/13-audit-logging/13-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete audit logging system with:
- JSON lines log files in /logs directory
- Authentication events (login success/failure, logout, password reset)
- Admin action events (unlock user, data export)
- Authorization failure events (Socket.IO unauthorized access attempts)
- Query API at GET /api/admin/audit-logs
- Log cleanup utility for 90-day retention
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`

2. Generate auth events:
   - Try logging in with wrong password (generates AUTH_LOGIN_FAILURE)
   - Log in successfully (generates AUTH_LOGIN_SUCCESS)
   - Log out (generates AUTH_LOGOUT)

3. Check log files:
   ```bash
   ls logs/
   cat logs/*.jsonl | jq .
   ```
   Verify:
   - File exists with today's date (YYYY-MM-DD.jsonl)
   - Each line is valid JSON
   - Events have timestamp, eventType, and context

4. Test query API (requires admin user):
   - Open browser console on app while logged in as admin
   - Run: `fetch('/api/admin/audit-logs').then(r => r.json()).then(console.log)`
   - Verify events returned match log files
   - Test filters: `?eventType=AUTH_LOGIN_SUCCESS&limit=5`

5. Verify SEC-06 coverage:
   - [x] Login attempts logged (success and failure)
   - [x] Admin actions logged (unlock, export)
   - [x] Logs queryable for investigation

Expected result: All security events visible and queryable.
  </how-to-verify>
  <resume-signal>Type "approved" if audit logging works correctly, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
Human verification confirms:
1. Log files created with valid JSON lines format
2. Authentication events captured
3. Admin actions logged
4. Query API returns filtered results
5. SEC-06 requirement satisfied
</verification>

<success_criteria>
- All event types logging correctly
- Log files in expected format and location
- Query API accessible to admins
- Requirement SEC-06 verified complete
</success_criteria>

<output>
After completion, create `.planning/phases/13-audit-logging/13-04-SUMMARY.md`
Update `.planning/REQUIREMENTS.md` to mark SEC-06 complete.
Update `.planning/STATE.md` to reflect phase completion.
</output>
