---
phase: 26-collections-presence
plan: 04
type: execute
wave: 3
depends_on: ["26-02"]
files_modified:
  - src/components/bookmark/bookmark-button.tsx
  - src/components/bookmark/bookmark-list.tsx
  - src/components/bookmark/bookmark-item.tsx
  - src/components/message/message-item.tsx
  - src/app/(workspace)/[workspaceSlug]/saved/page.tsx
  - src/components/workspace/workspace-sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can save a message by clicking bookmark button"
    - "User can view saved items in sidebar section"
    - "User can click saved item to jump to original context"
    - "User can remove item from saved list"
  artifacts:
    - path: "src/components/bookmark/bookmark-button.tsx"
      provides: "Bookmark toggle button for message actions"
      exports: ["BookmarkButton"]
    - path: "src/components/bookmark/bookmark-list.tsx"
      provides: "List of saved items with remove functionality"
      exports: ["BookmarkList"]
    - path: "src/app/(workspace)/[workspaceSlug]/saved/page.tsx"
      provides: "Saved items page"
  key_links:
    - from: "src/components/bookmark/bookmark-button.tsx"
      to: "src/lib/actions/bookmark.ts"
      via: "server action call"
      pattern: "toggleBookmark"
    - from: "src/components/bookmark/bookmark-list.tsx"
      to: "src/lib/actions/bookmark.ts"
      via: "server action call"
      pattern: "getBookmarks|removeBookmark"
    - from: "src/components/message/message-item.tsx"
      to: "src/components/bookmark/bookmark-button.tsx"
      via: "component import"
      pattern: "BookmarkButton"
---

<objective>
Build bookmarks/saved items UI components and page.

Purpose: Users need to save messages for later (BOOK-01), view saved items (BOOK-03), remove items (BOOK-04), and jump to original context (BOOK-05).

Output: BookmarkButton in message actions, Saved Items sidebar link, saved page with list.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/26-collections-presence/26-RESEARCH.md
@.planning/phases/26-collections-presence/26-02-SUMMARY.md
@src/components/message/message-item.tsx (add bookmark button here)
@src/components/workspace/workspace-sidebar.tsx (add saved link here)
@src/app/(workspace)/[workspaceSlug]/reminders/page.tsx (pattern for list page)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bookmark button component and add to message actions</name>
  <files>src/components/bookmark/bookmark-button.tsx, src/components/message/message-item.tsx</files>
  <action>
Create src/components/bookmark/bookmark-button.tsx:

1. "use client" directive
2. Import useState, useTransition from react
3. Import Bookmark icon from lucide-react
4. Import Button from ui/button
5. Import toggleBookmark from actions/bookmark
6. Import cn from lib/utils

7. Create BookmarkButton component:
   ```typescript
   interface BookmarkButtonProps {
     messageId: string;
     initialBookmarked?: boolean;
   }
   ```

8. Implementation:
   - useState for isBookmarked (from initialBookmarked)
   - useTransition for pending state
   - handleToggle: optimistic update, call toggleBookmark, revert on error
   - Render Button with:
     - variant="ghost", size="sm"
     - Opacity styling like ReminderMenuItem (opacity-0 group-hover:opacity-100)
     - When bookmarked: opacity-100, text-yellow-500, fill-current on icon
     - Bookmark icon with fill when bookmarked

Update src/components/message/message-item.tsx:
1. Import BookmarkButton
2. Add BookmarkButton to action buttons, after ReminderMenuItem:
   ```tsx
   <BookmarkButton messageId={message.id} />
   ```

Note: For now, initialBookmarked will default to false. Fetching initial state would require passing it from parent - defer to later if needed (users can see filled icon after clicking).
  </action>
  <verify>
npx tsc --noEmit src/components/bookmark/bookmark-button.tsx
grep -q "BookmarkButton" src/components/message/message-item.tsx
  </verify>
  <done>BookmarkButton component created and added to message action buttons.</done>
</task>

<task type="auto">
  <name>Task 2: Create saved items page and list components</name>
  <files>src/components/bookmark/bookmark-list.tsx, src/components/bookmark/bookmark-item.tsx, src/app/(workspace)/[workspaceSlug]/saved/page.tsx</files>
  <action>
Create src/components/bookmark/bookmark-item.tsx:

1. Display single bookmark with:
   - Message content preview (truncated)
   - Author name and timestamp
   - Channel/DM context indicator
   - Remove button (X icon) calling removeBookmark
   - Click handler to navigate to original message

2. For navigation (BOOK-05):
   - If bookmark.message.channelId: navigate to /{workspaceSlug}/channels/{channelSlug}
   - If bookmark.message.conversationId: navigate to /{workspaceSlug}/dm/{conversationId}
   - Use router.push

Create src/components/bookmark/bookmark-list.tsx:

1. "use client" with useEffect to fetch bookmarks
2. Use getBookmarks action on mount
3. Handle loading state
4. Map bookmarks to BookmarkItem components
5. Empty state: "No saved items yet. Bookmark messages to find them here."
6. Pass onRemove callback to update list after removal

Create src/app/(workspace)/[workspaceSlug]/saved/page.tsx:

1. Follow pattern from reminders/page.tsx
2. Header with Bookmark icon and "Saved Items" title
3. Render BookmarkList component
4. No detail panel needed (unlike reminders) - clicking navigates away

Use existing message display patterns from reminder-detail-panel or scheduled-messages-list.
  </action>
  <verify>
npx tsc --noEmit src/components/bookmark/bookmark-list.tsx src/components/bookmark/bookmark-item.tsx
ls src/app/\(workspace\)/\[workspaceSlug\]/saved/page.tsx
  </verify>
  <done>Saved items page exists with list component. Users can view and remove bookmarks.</done>
</task>

<task type="auto">
  <name>Task 3: Add Saved Items link to sidebar</name>
  <files>src/components/workspace/workspace-sidebar.tsx</files>
  <action>
Update src/components/workspace/workspace-sidebar.tsx:

1. Import Bookmark icon from lucide-react (if not already)

2. Add "Saved" link in the quick links section, after Reminders:
   ```tsx
   <Link
     href={`/${workspace.slug}/saved`}
     className={cn(
       "flex items-center gap-2 px-2 py-1.5 rounded-md text-sm hover:bg-accent transition-colors",
       pathname === `/${workspace.slug}/saved` && "bg-accent"
     )}
   >
     <Bookmark className="h-4 w-4" />
     Saved
   </Link>
   ```

Place after Reminders link for logical grouping (personal items: Notes, Scheduled, Reminders, Saved).
  </action>
  <verify>
grep -q "saved" src/components/workspace/workspace-sidebar.tsx
grep -q "Bookmark" src/components/workspace/workspace-sidebar.tsx
  </verify>
  <done>Saved Items link added to sidebar quick links section.</done>
</task>

</tasks>

<verification>
Build project to verify all components:
```bash
npm run build
```

Manual verification:
1. Navigate to a channel, see bookmark button in message actions
2. Click bookmark button, verify yellow fill appears
3. Click sidebar "Saved" link, see saved items page
4. Saved message appears in list
5. Click saved item, navigate to original message
6. Click X to remove, item disappears from list
</verification>

<success_criteria>
- BookmarkButton in message action bar with yellow highlight when bookmarked
- Saved items page at /[workspace]/saved
- Sidebar has "Saved" link with Bookmark icon
- Can view list of saved messages
- Can click to navigate to original message location
- Can remove bookmark from list
- BOOK-01, BOOK-03, BOOK-04, BOOK-05 covered
</success_criteria>

<output>
After completion, create `.planning/phases/26-collections-presence/26-04-SUMMARY.md`
</output>
